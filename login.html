<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Login — Research</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <script>window.tailwind = {config:{theme:{extend:{fontFamily:{sans:['Inter','ui-sans-serif','system-ui']}}}}}</script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="theme.css">
    <!-- Firebase SDK (optional) -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <!-- Optional: provide a `FIREBASE_CONFIG` object in a firebase-config.js file to enable cloud persistence -->
    <script src="firebase-config.js" defer></script>
    <style>
      .login-shell {
        position: relative;
        background:
          radial-gradient(circle at 20% 10%, rgba(251, 191, 36, 0.18), transparent 35%),
          radial-gradient(circle at 80% 20%, rgba(59, 130, 246, 0.16), transparent 35%),
          radial-gradient(circle at 50% 80%, rgba(139, 92, 246, 0.12), transparent 40%),
          #f8fafc;
      }
      .login-watermark {
        position: absolute;
        inset: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        pointer-events: none;
        opacity: 0.18;
        filter: grayscale(10%);
      }
      .login-watermark img {
        width: min(72vmin, 560px);
        filter: drop-shadow(0 10px 24px rgba(15, 23, 42, 0.18));
      }
      .login-card {
        backdrop-filter: blur(6px);
        background: rgba(255, 255, 255, 0.92);
        border: 1px solid rgba(203, 213, 225, 0.8);
      }
      .logo-badge {
        width: 90px;
        height: 90px;
        border-radius: 999px;
        background: #ffffff;
        border: 1px solid rgba(226, 232, 240, 0.9);
        display: grid;
        place-items: center;
        box-shadow: 0 10px 30px rgba(15, 23, 42, 0.15);
      }
      .logo-badge img { width: 64px; height: 64px; object-fit: contain; }
      @media (max-width: 640px){
        .login-watermark img { width: 82vmin; }
      }
    </style>
  </head>
  <body class="login-shell font-sans text-slate-800">
    <main class="relative min-h-screen flex items-center justify-center px-4">
      <div class="login-watermark" aria-hidden="true">
        <img src="./gsu-logo.png" alt="" />
      </div>
      <div class="relative z-10 w-full max-w-md p-6 card login-card">
        <div class="flex items-center gap-4">
          <div class="logo-badge">
            <img src="./gsu-logo.png" alt="Golden Success University" />
          </div>
          <div>
            <p class="text-xs uppercase tracking-widest text-amber-600 font-semibold">Golden Success University</p>
            <h2 class="text-xl font-semibold">Welcome back</h2>
            <p class="text-sm muted mt-1">Sign in to continue to the research demo.</p>
          </div>
        </div>

        <form id="loginForm" class="mt-4 space-y-3">
          <div>
            <label class="text-sm">Email</label>
            <input id="email" type="email" class="mt-1 block w-full rounded border-gray-200 p-2" required />
          </div>
          <div>
            <label class="text-sm">Password</label>
            <input id="password" type="password" class="mt-1 block w-full rounded border-gray-200 p-2" required />
          </div>

          <div class="flex items-center justify-between mt-4">
            <button type="submit" class="btn-primary">Login</button>
            <a href="register.html" class="text-sm yellow-link hover:underline">Register</a>
          </div>
        </form>

        <div id="msg" class="mt-3 text-sm text-red-600"></div>
        <div class="mt-4 text-xs muted">By using this demo you agree to the <a href="terms.html" class="yellow-link hover:underline">Terms & Data Use</a>.</div>
      </div>
    </main>

    <script>
      function showMsg(text, ok){ const el = document.getElementById('msg'); el.textContent = text; el.className = ok? 'mt-3 text-sm text-green-600' : 'mt-3 text-sm text-red-600'; }
      // show redirect message if came from registration
      if(new URLSearchParams(window.location.search).get('registered')){
        showMsg('Registration successful — please login', true);
      }

      document.getElementById('loginForm').addEventListener('submit', async function(e){
        e.preventDefault();
        const email = document.getElementById('email').value.trim().toLowerCase();
        const password = document.getElementById('password').value;
        // if Firebase config present, use Firebase Auth
        if(window.FIREBASE_CONFIG && window.firebase){
          try{
            if(!firebase.apps.length) firebase.initializeApp(window.FIREBASE_CONFIG);
            const userCred = await firebase.auth().signInWithEmailAndPassword(email, password);
            const u = userCred.user;
            // store a minimal currentUser for compatibility
            const userObj = { id: u.uid, name: u.displayName || u.email, email: u.email, role: 'student' };
            localStorage.setItem('currentUser::demo', JSON.stringify(userObj));
            showMsg('Login successful — redirecting...', true);
            setTimeout(()=> location.href = 'dashboard.html', 600);
          }catch(err){ showMsg(err.message || 'Firebase login failed'); }
          return;
        }

        // fallback: localStorage-based demo accounts
        const users = JSON.parse(localStorage.getItem('users::demo') || '[]');
        const user = users.find(u=> u.email === email && u.password === password);
        if(!user){ showMsg('Invalid credentials'); return; }
        localStorage.setItem('currentUser::demo', JSON.stringify({ id: user.id, name: user.name, email: user.email, role: user.role }));
        showMsg('Login successful — redirecting...', true);
        setTimeout(()=> location.href = 'dashboard.html', 600);
      });

      // if already logged in, redirect to dashboard
      (function(){
        // if Firebase available and user already signed in, prefer that
        if(window.FIREBASE_CONFIG && window.firebase && firebase.auth().currentUser){ location.href = 'dashboard.html'; return; }
        const cur = localStorage.getItem('currentUser::demo'); if(cur) location.href = 'dashboard.html';
      })();
    </script>
  </body>
</html>
